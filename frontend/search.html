<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог отелей</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD700',
                        secondary: '#FFC107',
                        background: '#121212',
                        text: '#f5f5f5',
                    },
                },
            },
        }
    </script>
    <style>
        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
    </style>
</head>
<body class="bg-background text-text font-sans min-h-screen flex flex-col">
    <!-- Заголовок -->
    <header class="bg-[#1E1E1E] text-primary py-4 px-6 shadow-md sticky top-0 z-50">
        <nav class="flex justify-center items-center">
            <ul class="flex gap-6" id="navMenu">
                <li><a href="index.html" class="hover:text-secondary transition-colors">Главная</a></li>
                <li><a href="catalog.html" class="hover:text-secondary transition-colors">Каталог отелей</a></li>
                <li><a href="login.html" class="hover:text-secondary transition-colors">Вход</a></li>
                <li><a href="register.html" class="hover:text-secondary transition-colors">Регистрация</a></li>
                <li id="profileTab" class="hidden"><a href="profile.html" class="hover:text-secondary transition-colors">Личный кабинет</a></li>
                <li id="logoutTab" class="hidden"><a href="#" id="logoutLink" class="hover:text-secondary transition-colors">Выйти</a></li>
            </ul>
        </nav>
    </header>

    <!-- Каталог отелей -->
    <main class="flex-grow px-4 py-8">
        <section class="max-w-6xl mx-auto bg-[#1E1E1E] p-8 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-primary text-center mb-6">Каталог отелей</h2>

            <!-- Фильтры и сортировка -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <label for="sort" class="text-sm font-medium text-primary mr-2">Сортировать по:</label>
                    <select id="sort" class="px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border">
                        <option value="name">Названию</option>
                        <option value="location">Локации</option>
                        <option value="pricePerNight">Цене</option>
                    </select>
                </div>
                <div>
                    <label for="search" class="text-sm font-medium text-primary mr-2">Поиск:</label>
                    <input type="text" id="search" placeholder="Введите название или локацию" class="px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border">
                </div>
            </div>

            <!-- Список отелей -->
            <div id="hotelList" class="hotel-grid"></div>
        </section>
    </main>

    <!-- Подвал -->
    <footer class="bg-background text-primary py-4 mt-auto text-center">
        <p>&copy; 2025 Система бронирования гостиниц</p>
    </footer>

    <script>
        // Объявляем функцию bookHotel в глобальной области видимости
        async function bookHotel(hotelId) {
    const sessionId = localStorage.getItem('sessionId');
    try {
        const response = await fetch('http://localhost:5000/api/bookings', {
            method: 'POST', // Убедитесь, что используется POST
            headers: {
                'Authorization': sessionId,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ hotelId }),
        });

        if (response.ok) {
            alert('Отель успешно забронирован!');
            window.location.href = 'profile.html';
        } else {
            const errorData = await response.json();
            alert(`Ошибка при бронировании: ${errorData.message}`);
        }
    } catch (error) {
        console.error('Ошибка при бронировании:', error);
        alert('Произошла ошибка. Попробуйте снова.');
    }
}

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded and parsed");

            const sessionId = localStorage.getItem('sessionId');
            const profileTab = document.getElementById('profileTab');
            const logoutTab = document.getElementById('logoutTab');

            let hotels = [
                {
                    "id": 1,
                    "name": "Hotel Hilton",
                    "location": "Moscow, Russia",
                    "pricePerNight": 5000,
                    "image": "png/hotel1.png"
                },
                {
                    "id": 2,
                    "name": "Hotel Marriott",
                    "location": "St. Petersburg, Russia",
                    "pricePerNight": 6000,
                    "image": "png/hotel2.png"
                },
                {
                    "id": 3,
                    "name": "Hotel Ritz-Carlton",
                    "location": "Novosibirsk, Russia",
                    "pricePerNight": 7000,
                    "image": "png/hotel3.png"
                },
                {
                    "id": 4,
                    "name": "Hotel Four Seasons",
                    "location": "Kazan, Russia",
                    "pricePerNight": 8000,
                    "image": "png/hotel4.png"
                },
                {
                    "id": 5,
                    "name": "Hotel Hyatt",
                    "location": "Ekaterinburg, Russia",
                    "pricePerNight": 6500,
                    "image": "png/hotel5.png"
                },
                {
                    "id": 6,
                    "name": "Hotel InterContinental",
                    "location": "Nizhny Novgorod, Russia",
                    "pricePerNight": 7500,
                    "image": "png/hotel6.png"
                },
                {
                    "id": 7,
                    "name": "Hotel Sheraton",
                    "location": "Samara, Russia",
                    "pricePerNight": 5500,
                    "image": "png/hotel7.png"
                },
                {
                    "id": 8,
                    "name": "Hotel Radisson Blu",
                    "location": "Rostov-on-Don, Russia",
                    "pricePerNight": 6200,
                    "image": "png/hotel8.png"
                },
                {
                    "id": 9,
                    "name": "Hotel Crowne Plaza",
                    "location": "Krasnodar, Russia",
                    "pricePerNight": 5800,
                    "image": "png/hotel9.png"
                },
                {
                    "id": 10,
                    "name": "Hotel Holiday Inn",
                    "location": "Voronezh, Russia",
                    "pricePerNight": 5200,
                    "image": "png/hotel10.png"
                }
            ];

            console.log("Hotels data:", hotels);

            if (sessionId) {
                profileTab.classList.remove('hidden');
                logoutTab.classList.remove('hidden');
                document.querySelectorAll('#navMenu li a[href="login.html"], #navMenu li a[href="register.html"]').forEach(link => {
                    link.parentElement.classList.add('hidden');
                });
                loadHotels(); // Загрузка списка отелей
            } else {
                profileTab.classList.add('hidden');
                logoutTab.classList.add('hidden');
                document.querySelectorAll('#navMenu li a[href="login.html"], #navMenu li a[href="register.html"]').forEach(link => {
                    link.parentElement.classList.remove('hidden');
                });
            }

            document.getElementById('logoutLink')?.addEventListener('click', async (e) => {
                e.preventDefault();

                try {
                    const response = await fetch('/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': sessionId,
                        },
                    });

                    if (response.ok) {
                        localStorage.removeItem('sessionId');
                        alert('Вы успешно вышли из системы.');
                        window.location.href = 'index.html';
                    } else {
                        const errorData = await response.json();
                        alert(`Ошибка при выходе из системы: ${errorData.message}`);
                    }
                } catch (error) {
                    console.error('Ошибка при выходе:', error);
                    alert('Произошла ошибка. Попробуйте снова.');
                }
            });

            document.getElementById('search').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                filterHotels(query);
            });

            document.getElementById('sort').addEventListener('change', (e) => {
                const sortBy = e.target.value;
                sortHotels(sortBy);
            });

            function loadHotels() {
                console.log("Loading hotels...");
                displayHotels(hotels);
            }

            function displayHotels(hotelsToDisplay) {
                console.log("Displaying hotels:", hotelsToDisplay);
                const hotelList = document.getElementById('hotelList');
                if (!hotelList) {
                    console.error("Element with id 'hotelList' not found.");
                    return;
                }
                hotelList.innerHTML = '';

                hotelsToDisplay.forEach(hotel => {
                    const hotelDiv = document.createElement('div');
                    hotelDiv.classList.add('bg-[#222222]', 'p-4', 'rounded-lg', 'shadow-lg');
                    hotelDiv.innerHTML = `
                        <img src="${hotel.image}" alt="${hotel.name}" class="w-full h-48 object-cover rounded-lg mb-4">
                        <h3 class="text-primary text-xl font-bold">${hotel.name}</h3>
                        <p class="text-text">${hotel.location}</p>
                        <p class="text-secondary font-bold mt-2">${hotel.pricePerNight} руб./ночь</p>
                        <button class="bg-primary text-background py-2 px-4 rounded-full mt-4 hover:bg-secondary transition-colors" onclick="bookHotel(${hotel.id})">Забронировать</button>
                    `;
                    hotelList.appendChild(hotelDiv);
                });
            }

            function filterHotels(query) {
                const filteredHotels = hotels.filter(hotel =>
                    hotel.name.toLowerCase().includes(query) ||
                    hotel.location.toLowerCase().includes(query)
                );
                displayHotels(filteredHotels);
            }

            function sortHotels(sortBy) {
                const sortedHotels = [...hotels].sort((a, b) => {
                    if (a[sortBy] < b[sortBy]) return -1;
                    if (a[sortBy] > b[sortBy]) return 1;
                    return 0;
                });
                displayHotels(sortedHotels);
            }
        });
    </script>
</body>
</html>

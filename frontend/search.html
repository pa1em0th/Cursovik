<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог отелей</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD700',
                        secondary: '#FFC107',
                        background: '#121212',
                        text: '#f5f5f5',
                        accent: '#FF6B6B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        glow: '0 0 15px rgba(255, 215, 0, 0.5)',
                    },
                },
            },
        }
    </script>
    <style>
        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .nav-bg {
            background-color: #1E1E1E; /* Непрозрачный фон для навигации */
        }
        .header-image {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-background text-text font-sans min-h-screen flex flex-col">
    <!-- Шапка -->
    <header class="nav-bg text-primary py-4 px-6 shadow-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center bg-[#1E1E1E]">
            <!-- Логотип -->
            <div class="flex items-center">
                <img src="png/logo.png" alt="Логотип" class="w-10 h-10 mr-4">
                <span class="text-xl font-bold">Hotel Booking</span>
            </div>
            <!-- Навигация -->
            <nav>
                <ul class="flex gap-6" id="navMenu">
                    <li><a href="index.html" class="hover:text-secondary transition-colors">Главная</a></li>
                    <li><a href="search.html" class="hover:text-secondary transition-colors">Поиск отелей</a></li>
                    <li><a href="articles.html" class="hover:text-secondary transition-colors">Полезные статьи</a></li>
                    <li><a href="login.html" class="hover:text-secondary transition-colors">Вход</a></li>
                    <li><a href="register.html" class="hover:text-secondary transition-colors">Регистрация</a></li>
                    <li id="profileTab" class="hidden"><a href="profile.html" class="hover:text-secondary transition-colors">Личный кабинет</a></li>
                    <li id="logoutTab" class="hidden"><a href="#" id="logoutLink" class="hover:text-secondary transition-colors">Выйти</a></li>
                </ul>
            </nav>
            <!-- Иконки соцсетей -->
            <div class="flex gap-4">
                <a href="#" class="text-primary hover:text-secondary transition-colors">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="text-primary hover:text-secondary transition-colors">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="text-primary hover:text-secondary transition-colors">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <main class="flex-grow">
        <!-- Герой-секция -->
        <section class="bg-[url('png/search_shapka.png')] bg-cover bg-center py-32 text-center relative">
            <div class="absolute inset-0 bg-black/50"></div>
            <div class="max-w-4xl mx-auto px-4 relative z-10">
                <h1 class="text-5xl font-bold text-primary mb-6">Каталог отелей</h1>
                <p class="text-lg text-gray-300 mb-8">Найдите идеальный отель для вашего отдыха.</p>
            </div>
        </section>

        <!-- Каталог отелей -->
        <section class="max-w-6xl mx-auto bg-[#1E1E1E] p-8 rounded-lg shadow-lg mt-8 mb-16">
            <h2 class="text-2xl font-bold text-primary text-center mb-6">Каталог отелей</h2>

            <!-- Фильтры и сортировка -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <label for="sort" class="text-sm font-medium text-primary mr-2">Сортировать по:</label>
                    <select id="sort" class="px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border">
                        <option value="name">Названию</option>
                        <option value="location">Локации</option>
                        <option value="pricePerNight">Цене</option>
                    </select>
                </div>
                <div>
                    <label for="search" class="text-sm font-medium text-primary mr-2">Поиск:</label>
                    <input type="text" id="search" placeholder="Введите название или локацию" class="px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border">
                </div>
            </div>

            <!-- Список отелей -->
            <div id="hotelList" class="hotel-grid"></div>
        </section>
    </main>

    <!-- Подвал -->
    <footer class="gradient-bg text-primary py-8 mt-auto">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Логотип и описание -->
                <div>
                    <div class="flex items-center mb-4">
                        <img src="png/logo.png" alt="Логотип" class="w-10 h-10 mr-4">
                        <span class="text-xl font-bold">Hotel Booking</span>
                    </div>
                    <p class="text-gray-400">Удобная система бронирования отелей по всему миру. Найдите идеальный отель для вашего отдыха.</p>
                </div>
                <!-- Навигация -->
                <div>
                    <h3 class="text-xl font-semibold text-primary mb-4">Навигация</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-secondary transition-colors">Главная</a></li>
                        <li><a href="search.html" class="text-gray-400 hover:text-secondary transition-colors">Поиск отелей</a></li>
                        <li><a href="login.html" class="text-gray-400 hover:text-secondary transition-colors">Вход</a></li>
                        <li><a href="register.html" class="text-gray-400 hover:text-secondary transition-colors">Регистрация</a></li>
                    </ul>
                </div>
                <!-- Соцсети -->
                <div>
                    <h3 class="text-xl font-semibold text-primary mb-4">Социальные сети</h3>
                    <div class="flex gap-4">
                        <a href="#" class="text-primary hover:text-secondary transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="text-primary hover:text-secondary transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-primary hover:text-secondary transition-colors">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2025 Система бронирования гостиниц. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script>
        async function calculateTotalAndBook(hotelId, pricePerNight) {
            const checkInDate = document.getElementById(`checkIn-${hotelId}`).value;
            const checkOutDate = document.getElementById(`checkOut-${hotelId}`).value;
            const roomNumber = document.getElementById(`roomNumber-${hotelId}`).value;

            if (!checkInDate || !checkOutDate || !roomNumber) {
                alert('Пожалуйста, выберите обе даты и номер комнаты.');
                return;
            }

            const checkIn = new Date(checkInDate);
            const checkOut = new Date(checkOutDate);
            const timeDiff = Math.abs(checkOut - checkIn);
            const numberOfNights = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            const totalCost = numberOfNights * pricePerNight;

            const confirmBooking = confirm(`Общая стоимость: ${totalCost} руб. Подтвердить бронирование?`);
            if (confirmBooking) {
                await bookHotel(hotelId, checkInDate, checkOutDate, roomNumber);
            }
        }

        async function bookHotel(hotelId, checkInDate, checkOutDate, roomNumber) {
            const sessionId = localStorage.getItem('sessionId');
            try {
                const response = await fetch('http://localhost:5000/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Authorization': sessionId,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ hotelId, checkInDate, checkOutDate, roomNumber }),
                });

                if (response.ok) {
                    alert('Отель успешно забронирован!');
                    window.location.href = 'profile.html';
                } else {
                    const errorData = await response.json();
                    alert(`Ошибка при бронировании: ${errorData.message}`);
                }
            } catch (error) {
                console.error('Ошибка при бронировании:', error);
                alert('Произошла ошибка. Попробуйте снова.');
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const sessionId = localStorage.getItem('sessionId');
            const profileTab = document.getElementById('profileTab');
            const logoutTab = document.getElementById('logoutTab');

            try {
                const response = await fetch('/api/hotels');
                if (!response.ok) {
                    throw new Error('Ошибка при загрузке данных отелей');
                }
                const hotels = await response.json();

                console.log('Загруженные отели на клиенте:', hotels); // Логирование для отладки

                if (!Array.isArray(hotels)) {
                    throw new Error('Данные отелей не являются массивом');
                }

                if (sessionId) {
                    profileTab.classList.remove('hidden');
                    logoutTab.classList.remove('hidden');
                    document.querySelectorAll('#navMenu li a[href="login.html"], #navMenu li a[href="register.html"]').forEach(link => {
                        link.parentElement.classList.add('hidden');
                    });
                    loadHotels(hotels);
                } else {
                    profileTab.classList.add('hidden');
                    logoutTab.classList.add('hidden');
                    document.querySelectorAll('#navMenu li a[href="login.html"], #navMenu li a[href="register.html"]').forEach(link => {
                        link.parentElement.classList.remove('hidden');
                    });
                }

                document.getElementById('logoutLink')?.addEventListener('click', async (e) => {
                    e.preventDefault();

                    try {
                        const response = await fetch('/logout', {
                            method: 'POST',
                            headers: {
                                'Authorization': sessionId,
                            },
                        });

                        if (response.ok) {
                            localStorage.removeItem('sessionId');
                            alert('Вы успешно вышли из системы.');
                            window.location.href = 'index.html';
                        } else {
                            const errorData = await response.json();
                            alert(`Ошибка при выходе из системы: ${errorData.message}`);
                        }
                    } catch (error) {
                        console.error('Ошибка при выходе:', error);
                        alert('Произошла ошибка. Попробуйте снова.');
                    }
                });

                document.getElementById('search').addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    filterHotels(query, hotels);
                });

                document.getElementById('sort').addEventListener('change', (e) => {
                    const sortBy = e.target.value;
                    sortHotels(sortBy, hotels);
                });

                function loadHotels(hotels) {
                    displayHotels(hotels);
                }

                function displayHotels(hotelsToDisplay) {
                    const hotelList = document.getElementById('hotelList');
                    hotelList.innerHTML = '';

                    hotelsToDisplay.forEach(hotel => {
                        const hotelDiv = document.createElement('div');
                        hotelDiv.classList.add('bg-[#222222]', 'p-4', 'rounded-lg', 'shadow-lg');
                        hotelDiv.innerHTML = `
                            <img src="${hotel.image}" alt="${hotel.name}" class="w-full h-48 object-cover rounded-lg mb-4">
                            <h3 class="text-primary text-xl font-bold">${hotel.name}</h3>
                            <p class="text-text">${hotel.location}</p>
                            <p class="text-secondary font-bold mt-2">${hotel.pricePerNight} руб./ночь</p>
                            <!-- Кнопка "Подробнее" -->
                            <button class="bg-blue-500 text-background py-2 px-4 rounded-full w-full hover:bg-blue-600 transition-colors mb-2" onclick="viewHotelDetails()">Подробнее</button>
                            <!-- Кнопка "Забронировать" -->
                            <button class="bg-primary text-background py-2 px-4 rounded-full w-full hover:bg-secondary transition-colors" onclick="toggleDatePicker(${hotel.id})">Забронировать</button>
                            <div id="datePicker-${hotel.id}" class="hidden mt-4">
                                <div class="mt-4">
                                    <label for="checkIn-${hotel.id}" class="text-primary">Дата заезда:</label>
                                    <input type="text" id="checkIn-${hotel.id}" class="flatpickr px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border mb-2" placeholder="Выберите дату">
                                </div>
                                <div class="mt-2">
                                    <label for="checkOut-${hotel.id}" class="text-primary">Дата выезда:</label>
                                    <input type="text" id="checkOut-${hotel.id}" class="flatpickr px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border mb-2" placeholder="Выберите дату">
                                </div>
                                <div class="mt-2">
                                    <label for="roomNumber-${hotel.id}" class="text-primary">Номер комнаты:</label>
                                    <select id="roomNumber-${hotel.id}" class="px-4 py-2 border border-gray-600 rounded-lg bg-[#222222] text-white focus:outline-none focus:border-primary transition-border mb-2">
                                        ${hotel.rooms ? hotel.rooms.map(room => `<option value="${room}">${room}</option>`).join('') : '<option value="">Номера недоступны</option>'}
                                    </select>
                                </div>
                                <button class="bg-accent text-background py-2 px-4 rounded-full w-full mt-4 hover:bg-red-600 transition-colors" onclick="calculateTotalAndBook(${hotel.id}, ${hotel.pricePerNight})">Забронировать</button>
                            </div>
                        `;
                        hotelList.appendChild(hotelDiv);

                        // Initialize flatpickr
                        flatpickr(`#checkIn-${hotel.id}`, { dateFormat: "Y-m-d" });
                        flatpickr(`#checkOut-${hotel.id}`, { dateFormat: "Y-m-d" });
                    });
                }

                window.toggleDatePicker = function(hotelId) {
                    const datePicker = document.getElementById(`datePicker-${hotelId}`);
                    if (datePicker) {
                        datePicker.classList.toggle('hidden');
                    }
                };

                window.viewHotelDetails = function() {
                    window.location.href = 'about-hotels.html';
                };

                function filterHotels(query, hotels) {
                    const filteredHotels = hotels.filter(hotel =>
                        hotel.name.toLowerCase().includes(query) ||
                        hotel.location.toLowerCase().includes(query)
                    );
                    displayHotels(filteredHotels);
                }

                function sortHotels(sortBy, hotels) {
                    const sortedHotels = [...hotels].sort((a, b) => {
                        if (a[sortBy] < b[sortBy]) return -1;
                        if (a[sortBy] > b[sortBy]) return 1;
                        return 0;
                    });
                    displayHotels(sortedHotels);
                }
            } catch (error) {
                console.error('Ошибка при загрузке данных отелей:', error);
            }
        });
    </script>
</body>
</html>
